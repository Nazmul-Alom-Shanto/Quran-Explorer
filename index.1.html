<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1a5f7a;
            --secondary-color: #57cc99;
            --accent-color: #ffd166;
            --text-dark: #2d3748;
            --text-light: #f8f9fa;
            --bg-light: #f8f9fa;
            --bg-card: #ffffff;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary-color) 0%, #2c7da0 100%);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 0 10px;
        }

        .logo {
            color: var(--accent-color);
            font-size: 2.2rem;
            font-weight: 700;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 1.8rem;
        }

        .search-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-bottom: 20px;
        }

        .search-box {
            display: flex;
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .search-box:focus-within {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: none;
            outline: none;
            font-size: 1rem;
            color: var(--text-dark);
        }

        .search-input::placeholder {
            color: #a0aec0;
        }

        .search-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 0 20px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .search-btn:hover {
            background: #38b27c;
        }

        .search-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .search-option {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-option.active {
            background: var(--accent-color);
            color: var(--text-dark);
        }

        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 900px;
            overflow: hidden;
            margin-bottom: 30px;
            position: relative;
        }

        .card-content {
            padding: 30px;
            text-align: center;
            max-height: 70vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--secondary-color) #f1f1f1;
        }

        .card-content::-webkit-scrollbar {
            width: 6px;
        }

        .card-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .card-content::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border-radius: 10px;
        }

        .ayah-no {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .ayah-arabic {
            font-size: 2.2rem;
            line-height: 1.6;
            color: var(--text-dark);
            margin-bottom: 25px;
            font-weight: 600;
        }

        .divider {
            width: 80%;
            height: 2px;
            background: linear-gradient(to right, transparent, var(--secondary-color), transparent);
            margin: 25px auto;
        }

        .ayah-bangla, .ayah-english {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 20px;
            color: var(--text-dark);
        }

        .tafsir-section {
            text-align: left;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }

        .tafsir-title {
            color: var(--primary-color);
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tafsir-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #4a5568;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            padding: 20px;
            background: var(--bg-light);
            border-top: 1px solid #e2e8f0;
        }

        .control-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .control-btn.play-pause {
            background: var(--secondary-color);
            width: 60px;
            height: 60px;
        }

        .surah-selector {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .surah-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .surah-btn:hover, .surah-btn.active {
            background: var(--accent-color);
            color: var(--text-dark);
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .logo {
                font-size: 1.8rem;
            }
            
            .ayah-arabic {
                font-size: 1.8rem;
            }
            
            .card-content {
                padding: 20px;
            }
            
            .controls {
                gap: 20px;
            }
            
            .control-btn {
                width: 45px;
                height: 45px;
            }
            
            .control-btn.play-pause {
                width: 55px;
                height: 55px;
            }
        }

        @media (max-width: 480px) {
            .ayah-arabic {
                font-size: 1.5rem;
            }
            
            .ayah-bangla, .ayah-english {
                font-size: 1rem;
            }
            
            .surah-selector {
                gap: 10px;
            }
            
            .surah-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="./" class="logo">
                <i class="fas fa-quran"></i>
                <span>Quran Explorer</span>
            </a>
        </header>

        <div class="search-container">
            <div class="search-box">
                <input type="text" class="search-input" id="search-input" placeholder="Search by surah name or ayah number...">
                <button class="search-btn" id="search-btn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="search-options">
                <button class="search-option active" id="option-surah">By Surah</button>
                <button class="search-option" id="option-ayah">By Ayah</button>
            </div>
        </div>

        <div class="surah-selector" id="surah-selector">
            <!-- Surah buttons will be dynamically added here -->
        </div>

        <div class="card">
            <div class="card-content" id="card-content">
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Loading Ayah...</p>
                </div>
                
                <h1 class="ayah-no" id="ayah-no">Quran (??:??)</h1>
                <h1 class="ayah-arabic" id="ayah-arabic" style="display: none;"></h1>
                
                <div class="divider"></div>
                
                <h1 class="ayah-bangla" id="ayah-bangla" style="display: none;"></h1>
                <h1 class="ayah-english" id="ayah-english" style="display: none;"></h1>
                
                <div class="tafsir-section" id="tafsir-section" style="display: none;">
                    <h3 class="tafsir-title">
                        <i class="fas fa-book-open"></i>
                        Tafsir (Explanation)
                    </h3>
                    <p class="tafsir-content" id="tafsir-bn"></p>
                    <p class="tafsir-content" id="tafsir-en"></p>
                </div>
            </div>
            
            <div class="controls">
                <button class="control-btn" id="btn-left">
                    <i class="material-icons">fast_rewind</i>
                </button>
                <button class="control-btn play-pause" id="btn-play-pause">
                    <i class="material-icons">play_arrow</i>
                </button>
                <button class="control-btn" id="btn-right">
                    <i class="material-icons">fast_forward</i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Data and configuration
        const baseURL = "https://api.alquran.cloud/v1/ayah/";
        const tafseerURL = "https://cdn.jsdelivr.net/gh/spa5k/tafsir_api@main/tafsir/";
        
        const ayahs_in_surahs = [
            7, 286, 200, 176, 120, 165, 206, 75, 129, 109, 123, 111,
            43, 52, 99, 128, 111, 110, 98, 135, 112, 78, 118, 64,
            77, 227, 93, 88, 69, 60, 34, 30, 73, 54, 45, 83,
            182, 88, 75, 85, 54, 53, 89, 59, 37, 35, 38, 29,
            18, 45, 60, 49, 62, 55, 78, 96, 29, 22, 24, 13,
            14, 11, 11, 18, 12, 12, 30, 52, 52, 44, 28, 28,
            20, 56, 40, 31, 50, 40, 46, 42, 29, 19, 36, 25,
            22, 17, 19, 26, 30, 20, 15, 21, 11, 8, 8, 19,
            5, 8, 8, 11, 11, 8, 3, 9, 5, 4, 7, 3,
            6, 3, 5, 4, 5, 6
        ];

        const surahNames = [
            "Al-Fatiha", "Al-Baqarah", "Al-Imran", "An-Nisa", "Al-Ma'idah", "Al-An'am", 
            "Al-A'raf", "Al-Anfal", "At-Tawbah", "Yunus", "Hud", "Yusuf", 
            "Ar-Ra'd", "Ibrahim", "Al-Hijr", "An-Nahl", "Al-Isra", "Al-Kahf", 
            "Maryam", "Ta-Ha", "Al-Anbiya", "Al-Hajj", "Al-Mu'minun", "An-Nur", 
            "Al-Furqan", "Ash-Shu'ara", "An-Naml", "Al-Qasas", "Al-Ankabut", "Ar-Rum", 
            "Luqman", "As-Sajda", "Al-Ahzab", "Saba", "Fatir", "Ya-Sin", 
            "As-Saffat", "Sad", "Az-Zumar", "Ghafir", "Fussilat", "Ash-Shura", 
            "Az-Zukhruf", "Ad-Dukhan", "Al-Jathiyah", "Al-Ahqaf", "Muhammad", "Al-Fath", 
            "Al-Hujurat", "Qaf", "Adh-Dhariyat", "At-Tur", "An-Najm", "Al-Qamar", 
            "Ar-Rahman", "Al-Waqi'ah", "Al-Hadid", "Al-Mujadila", "Al-Hashr", "Al-Mumtahanah", 
            "As-Saff", "Al-Jumu'ah", "Al-Munafiqun", "At-Taghabun", "At-Talaq", "At-Tahrim", 
            "Al-Mulk", "Al-Qalam", "Al-Haqqah", "Al-Ma'arij", "Nuh", "Al-Jinn", 
            "Al-Muzzammil", "Al-Muddathir", "Al-Qiyamah", "Al-Insan", "Al-Mursalat", "An-Naba", 
            "An-Nazi'at", "Abasa", "At-Takwir", "Al-Infitar", "Al-Mutaffifin", "Al-Inshiqaq", 
            "Al-Buruj", "At-Tariq", "Al-A'la", "Al-Ghashiyah", "Al-Fajr", "Al-Balad", 
            "Ash-Shams", "Al-Layl", "Ad-Duhaa", "Ash-Sharh", "At-Tin", "Al-Alaq", 
            "Al-Qadr", "Al-Bayyinah", "Az-Zalzalah", "Al-Adiyat", "Al-Qari'ah", "At-Takathur", 
            "Al-Asr", "Al-Humazah", "Al-Fil", "Quraysh", "Al-Ma'un", "Al-Kawthar", 
            "Al-Kafirun", "An-Nasr", "Al-Masad", "Al-Ikhlas", "Al-Falaq", "An-Nas"
        ];

        const tafsirBnSlug = 'bn-tafseer-ibn-e-kaseer';
        const tafsirEnSlug = 'en-al-jalalayn'; 

        // State variables
        let surahNumber = 1;
        let ayahNumber = 1;
        let audioURL = null;
        let audio = null;
        let wasPlaying = false;
        let isClicked = false;
        let currentSearchMode = "surah";

        // DOM elements
        const ayahArabic = document.getElementById("ayah-arabic");
        const ayahNo = document.getElementById("ayah-no");
        const ayahBangla = document.getElementById("ayah-bangla");
        const ayahEnglish = document.getElementById("ayah-english");
        const searchInput = document.getElementById("search-input");
        const searchBtn = document.getElementById("search-btn");
        const tafsirBn = document.getElementById("tafsir-bn");
        const tafsirEn = document.getElementById("tafsir-en");
        const playPauseBtn = document.getElementById("btn-play-pause");
        const leftBtn = document.getElementById("btn-left");
        const rightBtn = document.getElementById("btn-right");
        const optionSurah = document.getElementById("option-surah");
        const optionAyah = document.getElementById("option-ayah");
        const surahSelector = document.getElementById("surah-selector");
        const loading = document.getElementById("loading");
        const tafsirSection = document.getElementById("tafsir-section");
        const cardContent = document.getElementById("card-content");

        // Initialize the app
        function init() {
            setupSurahSelector();
            setupEventListeners();
            updateAyah();
        }

        // Create surah selector buttons
        function setupSurahSelector() {
            // Create buttons for first 10 surahs for simplicity
            for (let i = 0; i < 10; i++) {
                const btn = document.createElement("button");
                btn.className = "surah-btn";
                if (i === 0) btn.classList.add("active");
                btn.textContent = `${i+1}. ${surahNames[i]}`;
                btn.addEventListener("click", () => {
                    document.querySelectorAll(".surah-btn").forEach(b => b.classList.remove("active"));
                    btn.classList.add("active");
                    surahNumber = i + 1;
                    ayahNumber = 1;
                    updateAyah();
                });
                surahSelector.appendChild(btn);
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Search functionality
            searchBtn.addEventListener("click", handleSearch);
            searchInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") handleSearch();
            });

            // Search mode toggles
            optionSurah.addEventListener("click", () => {
                optionSurah.classList.add("active");
                optionAyah.classList.remove("active");
                currentSearchMode = "surah";
                searchInput.placeholder = "Search by surah name...";
            });

            optionAyah.addEventListener("click", () => {
                optionAyah.classList.add("active");
                optionSurah.classList.remove("active");
                currentSearchMode = "ayah";
                searchInput.placeholder = "Search by ayah (e.g., 2:255)...";
            });

            // Navigation controls
            leftBtn.addEventListener("click", goBackward);
            rightBtn.addEventListener("click", goForward);
            playPauseBtn.addEventListener("click", togglePlayPause);

            // Keyboard navigation
            document.addEventListener("keydown", (e) => {
                switch (e.key) {
                    case "ArrowLeft":
                        leftBtn.click();
                        break;
                    case "ArrowRight":
                        rightBtn.click();
                        break;
                    case " ":
                        e.preventDefault();
                        playPauseBtn.click();
                        break;
                }
            });
        }

        // Handle search functionality
        function handleSearch() {
            const query = searchInput.value.trim();
            if (!query) return;

            if (currentSearchMode === "surah") {
                // Search by surah name
                const surahIndex = surahNames.findIndex(name => 
                    name.toLowerCase().includes(query.toLowerCase())
                );
                
                if (surahIndex !== -1) {
                    surahNumber = surahIndex + 1;
                    ayahNumber = 1;
                    updateAyah();
                } else {
                    alert("Surah not found. Please try another name.");
                }
            } else {
                // Search by ayah (format: surah:ayah)
                const parts = query.split(":");
                if (parts.length === 2) {
                    const surah = parseInt(parts[0]);
                    const ayah = parseInt(parts[1]);
                    
                    if (surah >= 1 && surah <= 114 && ayah >= 1 && ayah <= ayahs_in_surahs[surah-1]) {
                        surahNumber = surah;
                        ayahNumber = ayah;
                        updateAyah();
                    } else {
                        alert("Invalid ayah reference. Please use format: surah:ayah (e.g., 2:255)");
                    }
                } else {
                    alert("Please use format: surah:ayah (e.g., 2:255)");
                }
            }
            
            searchInput.value = "";
        }

        // Update the displayed ayah
        async function updateAyah(isSpecial = false) {
            try {
                showLoading();
                
                if (audio) {
                    if (!audio.paused) {
                        audio.pause();
                        wasPlaying = true;
                    } else {
                        wasPlaying = false;
                    }
                    audio = null;
                }
                
                if (isSpecial) {
                    wasPlaying = true;
                }

                // Fetch Arabic text and audio
                const responseArabic = await fetch(`${baseURL}${surahNumber}:${ayahNumber}/ar.alafasy`);
                const dataArabic = await responseArabic.json();
                ayahArabic.textContent = dataArabic.data.text;
                ayahNo.textContent = `Quran (${dataArabic.data.surah.number}:${dataArabic.data.numberInSurah})`;
                audioURL = dataArabic.data.audio;

                // Fetch Bengali translation
                const responseBangla = await fetch(`${baseURL}${surahNumber}:${ayahNumber}/bn.bengali`);
                const dataBangla = await responseBangla.json();
                ayahBangla.textContent = dataBangla.data.text;

                // Fetch English translation
                const responseEnglish = await fetch(`${baseURL}${surahNumber}:${ayahNumber}/en.asad`);
                const dataEnglish = await responseEnglish.json();
                ayahEnglish.textContent = dataEnglish.data.text;

                // Fetch Tafsir (explanations)
                try {
                    const responseBanglaTafsir = await fetch(`${tafseerURL}${tafsirBnSlug}/${surahNumber}/${ayahNumber}.json`);
                    const dataTafsir = await responseBanglaTafsir.json();
                    tafsirBn.textContent = dataTafsir.text;

                    const responseEnglishTafsir = await fetch(`${tafseerURL}${tafsirEnSlug}/${surahNumber}/${ayahNumber}.json`);
                    const dataEnglishTafsir = await responseEnglishTafsir.json();
                    tafsirEn.textContent = dataEnglishTafsir.text;
                    
                    tafsirSection.style.display = "block";
                } catch (error) {
                    console.warn("Tafsir not available for this ayah");
                    tafsirSection.style.display = "none";
                }

                hideLoading();
                
                // Auto-play audio if was playing before
                if (wasPlaying && audioURL) {
                    audio = new Audio(audioURL);
                    audio.play();
                    playPauseBtn.innerHTML = "pause";
                    audio.addEventListener('ended', () => {
                        goForward(true);
                    });
                }
            } catch (error) {
                hideLoading();
                console.error("Error updating ayah:", error);
                ayahArabic.textContent = "Error loading ayah. Please check your connection.";
                ayahBangla.textContent = "";
                ayahEnglish.textContent = "";
                tafsirSection.style.display = "none";
            }
        }

        // Show loading state
        function showLoading() {
            loading.style.display = "flex";
            ayahArabic.style.display = "none";
            ayahBangla.style.display = "none";
            ayahEnglish.style.display = "none";
            tafsirSection.style.display = "none";
        }

        // Hide loading state
        function hideLoading() {
            loading.style.display = "none";
            ayahArabic.style.display = "block";
            ayahBangla.style.display = "block";
            ayahEnglish.style.display = "block";
        }

        // Navigate to previous ayah
        function goBackward() {
            if (isClicked) return;
            isClicked = true;
            
            if (surahNumber > 1 && ayahNumber === 1) {
                surahNumber -= 1;
                ayahNumber = ayahs_in_surahs[surahNumber - 1];
            } else if (ayahNumber > 1) {
                ayahNumber -= 1;
            } else {
                alert("This is the first ayah of the Quran.");
                isClicked = false;
                return;
            }
            
            updateAyah();
            setTimeout(() => { isClicked = false; }, 1000);
        }

        // Navigate to next ayah
        function goForward(isSpecial = false) {
            if (isClicked) return;
            isClicked = true;
            
            if (surahNumber < 114 && ayahNumber === ayahs_in_surahs[surahNumber - 1]) {
                surahNumber += 1;
                ayahNumber = 1;
            } else if (ayahNumber < ayahs_in_surahs[surahNumber - 1]) {
                ayahNumber += 1;
            } else {
                alert("This is the last ayah of the Quran.");
                isClicked = false;
                return;
            }
            
            updateAyah(isSpecial);
            setTimeout(() => { isClicked = false; }, 1000);
        }

        // Toggle play/pause audio
        function togglePlayPause() {
            if (audio) {
                if (audio.paused) {
                    audio.play();
                    playPauseBtn.innerHTML = "pause";
                } else {
                    audio.pause();
                    playPauseBtn.innerHTML = "play_arrow";
                }
            } else if (audioURL) {
                audio = new Audio(audioURL);
                audio.play();
                playPauseBtn.innerHTML = "pause";
                audio.addEventListener('ended', () => {
                    playPauseBtn.innerHTML = "play_arrow";
                    wasPlaying = true;
                    goForward(true);
                });
            } else {
                alert("Audio not available for this ayah.");
            }
        }

        // Initialize the application
        init();
    </script>
</body>
</html>
